//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/Zetzsche/Development/SimarisCurves/com.thoughtworks.xstream/src/com/thoughtworks/xstream/converters/reflection/SerializableConverter.java
//

#line 1 "/Users/Zetzsche/Development/SimarisCurves/com.thoughtworks.xstream/src/com/thoughtworks/xstream/converters/reflection/SerializableConverter.java"

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "com/thoughtworks/xstream/converters/ConversionException.h"
#include "com/thoughtworks/xstream/converters/MarshallingContext.h"
#include "com/thoughtworks/xstream/converters/UnmarshallingContext.h"
#include "com/thoughtworks/xstream/converters/reflection/AbstractReflectionConverter.h"
#include "com/thoughtworks/xstream/converters/reflection/MissingFieldException.h"
#include "com/thoughtworks/xstream/converters/reflection/ObjectAccessException.h"
#include "com/thoughtworks/xstream/converters/reflection/ReflectionProvider.h"
#include "com/thoughtworks/xstream/converters/reflection/SerializableConverter.h"
#include "com/thoughtworks/xstream/converters/reflection/SerializationMethodInvoker.h"
#include "com/thoughtworks/xstream/core/ClassLoaderReference.h"
#include "com/thoughtworks/xstream/core/JVM.h"
#include "com/thoughtworks/xstream/core/util/CustomObjectInputStream.h"
#include "com/thoughtworks/xstream/core/util/CustomObjectOutputStream.h"
#include "com/thoughtworks/xstream/core/util/HierarchicalStreams.h"
#include "com/thoughtworks/xstream/io/ExtendedHierarchicalStreamWriterHelper.h"
#include "com/thoughtworks/xstream/io/HierarchicalStreamReader.h"
#include "com/thoughtworks/xstream/io/HierarchicalStreamWriter.h"
#include "com/thoughtworks/xstream/mapper/Mapper.h"
#include "java/io/IOException.h"
#include "java/io/InvalidObjectException.h"
#include "java/io/ObjectInputValidation.h"
#include "java/io/ObjectStreamClass.h"
#include "java/io/ObjectStreamField.h"
#include "java/io/Serializable.h"
#include "java/lang/ClassLoader.h"
#include "java/lang/IllegalAccessException.h"
#include "java/lang/IllegalArgumentException.h"
#include "java/lang/NoSuchFieldException.h"
#include "java/lang/SecurityException.h"
#include "java/lang/UnsupportedOperationException.h"
#include "java/lang/reflect/Field.h"
#include "java/util/ArrayList.h"
#include "java/util/Collections.h"
#include "java/util/HashMap.h"
#include "java/util/Iterator.h"
#include "java/util/List.h"
#include "java/util/Map.h"
#include "java/util/Set.h"


#line 62
@implementation ComThoughtworksXstreamConvertersReflectionSerializableConverter

NSString * ComThoughtworksXstreamConvertersReflectionSerializableConverter_ELEMENT_NULL_ = @"null";
NSString * ComThoughtworksXstreamConvertersReflectionSerializableConverter_ELEMENT_DEFAULT_ = @"default";
NSString * ComThoughtworksXstreamConvertersReflectionSerializableConverter_ELEMENT_UNSERIALIZABLE_PARENTS_ = @"unserializable-parents";
NSString * ComThoughtworksXstreamConvertersReflectionSerializableConverter_ATTRIBUTE_CLASS_ = @"class";
NSString * ComThoughtworksXstreamConvertersReflectionSerializableConverter_ATTRIBUTE_SERIALIZATION_ = @"serialization";
NSString * ComThoughtworksXstreamConvertersReflectionSerializableConverter_ATTRIBUTE_VALUE_CUSTOM_ = @"custom";
NSString * ComThoughtworksXstreamConvertersReflectionSerializableConverter_ELEMENT_FIELDS_ = @"fields";
NSString * ComThoughtworksXstreamConvertersReflectionSerializableConverter_ELEMENT_FIELD_ = @"field";
NSString * ComThoughtworksXstreamConvertersReflectionSerializableConverter_ATTRIBUTE_NAME_ = @"name";


#line 83
- (instancetype)initComThoughtworksXstreamConvertersReflectionSerializableConverterWithComThoughtworksXstreamMapperMapper:(id<ComThoughtworksXstreamMapperMapper>)mapper
                                                         withComThoughtworksXstreamConvertersReflectionReflectionProvider:(id<ComThoughtworksXstreamConvertersReflectionReflectionProvider>)reflectionProvider
                                                                       withComThoughtworksXstreamCoreClassLoaderReference:(ComThoughtworksXstreamCoreClassLoaderReference *)classLoaderReference {
  if (self =
#line 84
  [super initWithComThoughtworksXstreamMapperMapper:mapper withComThoughtworksXstreamConvertersReflectionReflectionProvider:[[ComThoughtworksXstreamConvertersReflectionSerializableConverter_UnserializableParentsReflectionProvider alloc] initWithComThoughtworksXstreamConvertersReflectionReflectionProvider:reflectionProvider]]) {
    
#line 85
    self->classLoaderReference_ = classLoaderReference;
  }
  return self;
}

- (instancetype)initWithComThoughtworksXstreamMapperMapper:(id<ComThoughtworksXstreamMapperMapper>)mapper
withComThoughtworksXstreamConvertersReflectionReflectionProvider:(id<ComThoughtworksXstreamConvertersReflectionReflectionProvider>)reflectionProvider
        withComThoughtworksXstreamCoreClassLoaderReference:(ComThoughtworksXstreamCoreClassLoaderReference *)classLoaderReference {
  return [self initComThoughtworksXstreamConvertersReflectionSerializableConverterWithComThoughtworksXstreamMapperMapper:
#line 83
mapper withComThoughtworksXstreamConvertersReflectionReflectionProvider:reflectionProvider withComThoughtworksXstreamCoreClassLoaderReference:classLoaderReference];
}


#line 91
- (instancetype)initWithComThoughtworksXstreamMapperMapper:(id<ComThoughtworksXstreamMapperMapper>)mapper
withComThoughtworksXstreamConvertersReflectionReflectionProvider:(id<ComThoughtworksXstreamConvertersReflectionReflectionProvider>)reflectionProvider
                                   withJavaLangClassLoader:(JavaLangClassLoader *)classLoader {
  return
#line 92
  [self initComThoughtworksXstreamConvertersReflectionSerializableConverterWithComThoughtworksXstreamMapperMapper:mapper withComThoughtworksXstreamConvertersReflectionReflectionProvider:reflectionProvider withComThoughtworksXstreamCoreClassLoaderReference:[[ComThoughtworksXstreamCoreClassLoaderReference alloc] initWithJavaLangClassLoader:classLoader]];
}


#line 98
- (instancetype)initWithComThoughtworksXstreamMapperMapper:(id<ComThoughtworksXstreamMapperMapper>)mapper
withComThoughtworksXstreamConvertersReflectionReflectionProvider:(id<ComThoughtworksXstreamConvertersReflectionReflectionProvider>)reflectionProvider {
  return
#line 99
  [self initComThoughtworksXstreamConvertersReflectionSerializableConverterWithComThoughtworksXstreamMapperMapper:mapper withComThoughtworksXstreamConvertersReflectionReflectionProvider:[[ComThoughtworksXstreamConvertersReflectionSerializableConverter_UnserializableParentsReflectionProvider alloc] initWithComThoughtworksXstreamConvertersReflectionReflectionProvider:reflectionProvider] withComThoughtworksXstreamCoreClassLoaderReference:[[ComThoughtworksXstreamCoreClassLoaderReference alloc] initWithJavaLangClassLoader:nil]];
}


#line 102
- (jboolean)canConvertWithIOSClass:(IOSClass *)type {
  
#line 103
  return [ComThoughtworksXstreamCoreJVM canCreateDerivedObjectOutputStream] && [self isSerializableWithIOSClass:type];
}


#line 106
- (jboolean)isSerializableWithIOSClass:(IOSClass *)type {
  
#line 107
  if (type != nil &&
#line 108
  [[IOSClass classWithProtocol:@protocol(JavaIoSerializable)] isAssignableFrom:type] &&
#line 109
  ![type isInterface] &&
#line 110
  ([((ComThoughtworksXstreamConvertersReflectionSerializationMethodInvoker *) nil_chk(serializationMethodInvoker_)) supportsReadObjectWithIOSClass:type withBoolean:YES] || [serializationMethodInvoker_ supportsWriteObjectWithIOSClass:
#line 111
  type withBoolean:YES])) {
    for (id<JavaUtilIterator> iter = [((id<JavaUtilList>) nil_chk([self hierarchyForWithIOSClass:type])) iterator]; [((id<JavaUtilIterator>) nil_chk(iter)) hasNext]; ) {
      if (![[IOSClass classWithProtocol:@protocol(JavaIoSerializable)] isAssignableFrom:(IOSClass *) check_class_cast([iter next], [IOSClass class])]) {
        return [self canAccessWithIOSClass:type];
      }
    }
    return YES;
  }
  return NO;
}


#line 122
- (void)doMarshalWithId:(id)source
withComThoughtworksXstreamIoHierarchicalStreamWriter:(id<ComThoughtworksXstreamIoHierarchicalStreamWriter>)writer
withComThoughtworksXstreamConvertersMarshallingContext:(id<ComThoughtworksXstreamConvertersMarshallingContext>)context {
  
#line 123
  NSString *attributeName = [((id<ComThoughtworksXstreamMapperMapper>) nil_chk(mapper_)) aliasForSystemAttributeWithNSString:ComThoughtworksXstreamConvertersReflectionSerializableConverter_ATTRIBUTE_SERIALIZATION_];
  if (attributeName != nil) {
    [((id<ComThoughtworksXstreamIoHierarchicalStreamWriter>) nil_chk(writer)) addAttributeWithNSString:attributeName withNSString:ComThoughtworksXstreamConvertersReflectionSerializableConverter_ATTRIBUTE_VALUE_CUSTOM_];
  }
  
#line 129
  IOSObjectArray *currentType = [IOSObjectArray arrayWithLength:1 type:[IOSClass classWithClass:[IOSClass class]]];
  IOSBooleanArray *writtenClassWrapper = [IOSBooleanArray arrayWithBooleans:(jboolean[]){ NO } count:1];
  
#line 132
  id<ComThoughtworksXstreamCoreUtilCustomObjectOutputStream_StreamCallback> callback = [[ComThoughtworksXstreamConvertersReflectionSerializableConverter_$1 alloc] initWithComThoughtworksXstreamConvertersReflectionSerializableConverter:self withComThoughtworksXstreamIoHierarchicalStreamWriter:writer withComThoughtworksXstreamConvertersMarshallingContext:context withIOSClassArray:currentType withId:source withBooleanArray:writtenClassWrapper];
  
#line 236
  @try {
    jboolean mustHandleUnserializableParent = NO;
    id<JavaUtilIterator> classHieararchy = [((id<JavaUtilList>) nil_chk([self hierarchyForWithIOSClass:[nil_chk(source) getClass]])) iterator];
    while ([((id<JavaUtilIterator>) nil_chk(classHieararchy)) hasNext]) {
      IOSObjectArray_Set(currentType, 0, (IOSClass *) check_class_cast([classHieararchy next], [IOSClass class]));
      if (![[IOSClass classWithProtocol:@protocol(JavaIoSerializable)] isAssignableFrom:IOSObjectArray_Get(currentType, 0)]) {
        mustHandleUnserializableParent = YES;
        continue;
      }
      else {
        
#line 245
        if (mustHandleUnserializableParent) {
          [self marshalUnserializableParentWithComThoughtworksXstreamIoHierarchicalStreamWriter:writer withComThoughtworksXstreamConvertersMarshallingContext:context withId:source];
          mustHandleUnserializableParent = NO;
        }
        if ([((ComThoughtworksXstreamConvertersReflectionSerializationMethodInvoker *) nil_chk(serializationMethodInvoker_)) supportsWriteObjectWithIOSClass:IOSObjectArray_Get(currentType, 0) withBoolean:NO]) {
          *IOSBooleanArray_GetRef(writtenClassWrapper, 0) = YES;
          [((id<ComThoughtworksXstreamIoHierarchicalStreamWriter>) nil_chk(writer)) startNodeWithNSString:[mapper_ serializedClassWithIOSClass:IOSObjectArray_Get(currentType, 0)]];
          if (IOSObjectArray_Get(currentType, 0) != [mapper_ defaultImplementationOfWithIOSClass:IOSObjectArray_Get(currentType, 0)]) {
            NSString *classAttributeName = [mapper_ aliasForSystemAttributeWithNSString:ComThoughtworksXstreamConvertersReflectionSerializableConverter_ATTRIBUTE_CLASS_];
            if (classAttributeName != nil) {
              [writer addAttributeWithNSString:classAttributeName withNSString:[((IOSClass *) nil_chk(IOSObjectArray_Get(currentType, 0))) getName]];
            }
          }
          ComThoughtworksXstreamCoreUtilCustomObjectOutputStream *objectOutputStream = [ComThoughtworksXstreamCoreUtilCustomObjectOutputStream getInstanceWithComThoughtworksXstreamConvertersDataHolder:context withComThoughtworksXstreamCoreUtilCustomObjectOutputStream_StreamCallback:callback];
          [serializationMethodInvoker_ callWriteObjectWithIOSClass:IOSObjectArray_Get(currentType, 0) withId:source withJavaIoObjectOutputStream:objectOutputStream];
          (void) [((ComThoughtworksXstreamCoreUtilCustomObjectOutputStream *) nil_chk(objectOutputStream)) popCallback];
          [writer endNode];
        }
        else
#line 262
        if ([serializationMethodInvoker_ supportsReadObjectWithIOSClass:IOSObjectArray_Get(currentType, 0) withBoolean:NO]) {
          
#line 266
          *IOSBooleanArray_GetRef(writtenClassWrapper, 0) = YES;
          [((id<ComThoughtworksXstreamIoHierarchicalStreamWriter>) nil_chk(writer)) startNodeWithNSString:[mapper_ serializedClassWithIOSClass:IOSObjectArray_Get(currentType, 0)]];
          if (IOSObjectArray_Get(currentType, 0) != [mapper_ defaultImplementationOfWithIOSClass:IOSObjectArray_Get(currentType, 0)]) {
            NSString *classAttributeName = [mapper_ aliasForSystemAttributeWithNSString:ComThoughtworksXstreamConvertersReflectionSerializableConverter_ATTRIBUTE_CLASS_];
            if (classAttributeName != nil) {
              [writer addAttributeWithNSString:classAttributeName withNSString:[((IOSClass *) nil_chk(IOSObjectArray_Get(currentType, 0))) getName]];
            }
          }
          [callback defaultWriteObject];
          [writer endNode];
        }
        else {
          
#line 277
          *IOSBooleanArray_GetRef(writtenClassWrapper, 0) = NO;
          [callback defaultWriteObject];
          if (IOSBooleanArray_Get(writtenClassWrapper, 0)) {
            [((id<ComThoughtworksXstreamIoHierarchicalStreamWriter>) nil_chk(writer)) endNode];
          }
        }
      }
    }
  }
  @catch (
#line 285
  JavaIoIOException *e) {
    @throw [[ComThoughtworksXstreamConvertersReflectionObjectAccessException alloc] initWithNSString:@"Could not call defaultWriteObject()" withJavaLangThrowable:e];
  }
}


#line 290
- (void)marshalUnserializableParentWithComThoughtworksXstreamIoHierarchicalStreamWriter:(id<ComThoughtworksXstreamIoHierarchicalStreamWriter>)writer
                                 withComThoughtworksXstreamConvertersMarshallingContext:(id<ComThoughtworksXstreamConvertersMarshallingContext>)context
                                                                                 withId:(id)replacedSource {
  
#line 291
  [((id<ComThoughtworksXstreamIoHierarchicalStreamWriter>) nil_chk(writer)) startNodeWithNSString:ComThoughtworksXstreamConvertersReflectionSerializableConverter_ELEMENT_UNSERIALIZABLE_PARENTS_];
  [super doMarshalWithId:replacedSource withComThoughtworksXstreamIoHierarchicalStreamWriter:writer withComThoughtworksXstreamConvertersMarshallingContext:context];
  [writer endNode];
}


#line 296
- (id)readFieldWithJavaIoObjectStreamField:(JavaIoObjectStreamField *)field
                              withIOSClass:(IOSClass *)type
                                    withId:(id)instance {
  
#line 297
  @try {
    JavaLangReflectField *javaField = [((IOSClass *) nil_chk(type)) getDeclaredField:[((JavaIoObjectStreamField *) nil_chk(field)) getName]];
    if (![((JavaLangReflectField *) nil_chk(javaField)) isAccessible]) {
      [javaField setAccessibleWithBoolean:YES];
    }
    return [javaField getWithId:instance];
  }
  @catch (
#line 303
  JavaLangIllegalArgumentException *e) {
    @throw [[ComThoughtworksXstreamConvertersReflectionObjectAccessException alloc] initWithNSString:JreStrcat("$@C$", @"Could not get field ", [((JavaIoObjectStreamField *) nil_chk(field)) getClass], '.', [field getName]) withJavaLangThrowable:e];
  }
  @catch (
#line 305
  JavaLangIllegalAccessException *e) {
    @throw [[ComThoughtworksXstreamConvertersReflectionObjectAccessException alloc] initWithNSString:JreStrcat("$@C$", @"Could not get field ", [((JavaIoObjectStreamField *) nil_chk(field)) getClass], '.', [field getName]) withJavaLangThrowable:e];
  }
  @catch (
#line 307
  JavaLangNoSuchFieldException *e) {
    @throw [[ComThoughtworksXstreamConvertersReflectionObjectAccessException alloc] initWithNSString:JreStrcat("$@C$", @"Could not get field ", [((JavaIoObjectStreamField *) nil_chk(field)) getClass], '.', [field getName]) withJavaLangThrowable:e];
  }
  @catch (
#line 309
  JavaLangSecurityException *e) {
    @throw [[ComThoughtworksXstreamConvertersReflectionObjectAccessException alloc] initWithNSString:JreStrcat("$@C$", @"Could not get field ", [((JavaIoObjectStreamField *) nil_chk(field)) getClass], '.', [field getName]) withJavaLangThrowable:e];
  }
}


#line 314
- (id<JavaUtilList>)hierarchyForWithIOSClass:(IOSClass *)type {
  
#line 315
  id<JavaUtilList> result = [[JavaUtilArrayList alloc] init];
  while (type != [IOSClass classWithClass:[NSObject class]] && type != nil) {
    [result addWithId:type];
    type = [((IOSClass *) nil_chk(type)) getSuperclass];
  }
  
#line 322
  [JavaUtilCollections reverseWithJavaUtilList:result];
  
#line 324
  return result;
}


#line 327
- (id)doUnmarshalWithId:(id)result
withComThoughtworksXstreamIoHierarchicalStreamReader:(id<ComThoughtworksXstreamIoHierarchicalStreamReader>)reader
withComThoughtworksXstreamConvertersUnmarshallingContext:(id<ComThoughtworksXstreamConvertersUnmarshallingContext>)context {
  
#line 329
  IOSObjectArray *currentType = [IOSObjectArray arrayWithLength:1 type:[IOSClass classWithClass:[IOSClass class]]];
  
#line 331
  NSString *attributeName = [((id<ComThoughtworksXstreamMapperMapper>) nil_chk(mapper_)) aliasForSystemAttributeWithNSString:ComThoughtworksXstreamConvertersReflectionSerializableConverter_ATTRIBUTE_SERIALIZATION_];
  if (attributeName != nil && ![((NSString *) nil_chk(ComThoughtworksXstreamConvertersReflectionSerializableConverter_ATTRIBUTE_VALUE_CUSTOM_)) isEqual:[((id<ComThoughtworksXstreamIoHierarchicalStreamReader>) nil_chk(reader)) getAttributeWithNSString:attributeName]]) {
    @throw [[ComThoughtworksXstreamConvertersConversionException alloc] initWithNSString:@"Cannot deserialize object with new readObject()/writeObject() methods"];
  }
  
#line 336
  id<ComThoughtworksXstreamCoreUtilCustomObjectInputStream_StreamCallback> callback = [[ComThoughtworksXstreamConvertersReflectionSerializableConverter_$2 alloc] initWithComThoughtworksXstreamConvertersReflectionSerializableConverter:self withComThoughtworksXstreamIoHierarchicalStreamReader:reader withComThoughtworksXstreamConvertersUnmarshallingContext:context withId:result withIOSClassArray:currentType];
  
#line 439
  while ([((id<ComThoughtworksXstreamIoHierarchicalStreamReader>) nil_chk(reader)) hasMoreChildren]) {
    [reader moveDown];
    NSString *nodeName = [reader getNodeName];
    if ([((NSString *) nil_chk(nodeName)) isEqual:ComThoughtworksXstreamConvertersReflectionSerializableConverter_ELEMENT_UNSERIALIZABLE_PARENTS_]) {
      (void) [super doUnmarshalWithId:result withComThoughtworksXstreamIoHierarchicalStreamReader:reader withComThoughtworksXstreamConvertersUnmarshallingContext:context];
    }
    else {
      
#line 445
      NSString *classAttribute = [ComThoughtworksXstreamCoreUtilHierarchicalStreams readClassAttributeWithComThoughtworksXstreamIoHierarchicalStreamReader:reader withComThoughtworksXstreamMapperMapper:mapper_];
      if (classAttribute == nil) {
        IOSObjectArray_Set(currentType, 0, [mapper_ defaultImplementationOfWithIOSClass:[mapper_ realClassWithNSString:nodeName]]);
      }
      else {
        
#line 449
        IOSObjectArray_Set(currentType, 0, [mapper_ realClassWithNSString:classAttribute]);
      }
      if ([((ComThoughtworksXstreamConvertersReflectionSerializationMethodInvoker *) nil_chk(serializationMethodInvoker_)) supportsReadObjectWithIOSClass:IOSObjectArray_Get(currentType, 0) withBoolean:NO]) {
        ComThoughtworksXstreamCoreUtilCustomObjectInputStream *objectInputStream =
#line 453
        [ComThoughtworksXstreamCoreUtilCustomObjectInputStream getInstanceWithComThoughtworksXstreamConvertersDataHolder:context withComThoughtworksXstreamCoreUtilCustomObjectInputStream_StreamCallback:callback withComThoughtworksXstreamCoreClassLoaderReference:classLoaderReference_];
        [serializationMethodInvoker_ callReadObjectWithIOSClass:IOSObjectArray_Get(currentType, 0) withId:result withJavaIoObjectInputStream:objectInputStream];
        (void) [((ComThoughtworksXstreamCoreUtilCustomObjectInputStream *) nil_chk(objectInputStream)) popCallback];
      }
      else {
        
#line 457
        @try {
          [callback defaultReadObject];
        }
        @catch (
#line 459
        JavaIoIOException *e) {
          @throw [[ComThoughtworksXstreamConvertersReflectionObjectAccessException alloc] initWithNSString:@"Could not call defaultWriteObject()" withJavaLangThrowable:e];
        }
      }
    }
    [reader moveUp];
  }
  
#line 467
  return result;
}


#line 470
- (void)doMarshalConditionallyWithId:(id)source
withComThoughtworksXstreamIoHierarchicalStreamWriter:(id<ComThoughtworksXstreamIoHierarchicalStreamWriter>)writer
withComThoughtworksXstreamConvertersMarshallingContext:(id<ComThoughtworksXstreamConvertersMarshallingContext>)context {
  
#line 471
  if ([self isSerializableWithIOSClass:[nil_chk(source) getClass]]) {
    [self doMarshalWithId:source withComThoughtworksXstreamIoHierarchicalStreamWriter:writer withComThoughtworksXstreamConvertersMarshallingContext:context];
  }
  else {
    
#line 474
    [super doMarshalWithId:source withComThoughtworksXstreamIoHierarchicalStreamWriter:writer withComThoughtworksXstreamConvertersMarshallingContext:context];
  }
}


#line 478
- (id)doUnmarshalConditionallyWithId:(id)result
withComThoughtworksXstreamIoHierarchicalStreamReader:(id<ComThoughtworksXstreamIoHierarchicalStreamReader>)reader
withComThoughtworksXstreamConvertersUnmarshallingContext:(id<ComThoughtworksXstreamConvertersUnmarshallingContext>)context {
  
#line 479
  return [self isSerializableWithIOSClass:[nil_chk(result) getClass]] ? [self doUnmarshalWithId:result withComThoughtworksXstreamIoHierarchicalStreamReader:reader withComThoughtworksXstreamConvertersUnmarshallingContext:context] : [super doUnmarshalWithId:result withComThoughtworksXstreamIoHierarchicalStreamReader:reader withComThoughtworksXstreamConvertersUnmarshallingContext:context];
}

- (void)copyAllFieldsTo:(ComThoughtworksXstreamConvertersReflectionSerializableConverter *)other {
  [super copyAllFieldsTo:other];
  other->classLoaderReference_ = classLoaderReference_;
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithComThoughtworksXstreamMapperMapper:withComThoughtworksXstreamConvertersReflectionReflectionProvider:withComThoughtworksXstreamCoreClassLoaderReference:", "SerializableConverter", NULL, 0x1, NULL },
    { "initWithComThoughtworksXstreamMapperMapper:withComThoughtworksXstreamConvertersReflectionReflectionProvider:withJavaLangClassLoader:", "SerializableConverter", NULL, 0x1, NULL },
    { "initWithComThoughtworksXstreamMapperMapper:withComThoughtworksXstreamConvertersReflectionReflectionProvider:", "SerializableConverter", NULL, 0x1, NULL },
    { "canConvertWithIOSClass:", "canConvert", "Z", 0x1, NULL },
    { "isSerializableWithIOSClass:", "isSerializable", "Z", 0x2, NULL },
    { "doMarshalWithId:withComThoughtworksXstreamIoHierarchicalStreamWriter:withComThoughtworksXstreamConvertersMarshallingContext:", "doMarshal", "V", 0x1, NULL },
    { "marshalUnserializableParentWithComThoughtworksXstreamIoHierarchicalStreamWriter:withComThoughtworksXstreamConvertersMarshallingContext:withId:", "marshalUnserializableParent", "V", 0x4, NULL },
    { "readFieldWithJavaIoObjectStreamField:withIOSClass:withId:", "readField", "Ljava.lang.Object;", 0x2, NULL },
    { "hierarchyForWithIOSClass:", "hierarchyFor", "Ljava.util.List;", 0x4, NULL },
    { "doUnmarshalWithId:withComThoughtworksXstreamIoHierarchicalStreamReader:withComThoughtworksXstreamConvertersUnmarshallingContext:", "doUnmarshal", "Ljava.lang.Object;", 0x1, NULL },
    { "doMarshalConditionallyWithId:withComThoughtworksXstreamIoHierarchicalStreamWriter:withComThoughtworksXstreamConvertersMarshallingContext:", "doMarshalConditionally", "V", 0x4, NULL },
    { "doUnmarshalConditionallyWithId:withComThoughtworksXstreamIoHierarchicalStreamReader:withComThoughtworksXstreamConvertersUnmarshallingContext:", "doUnmarshalConditionally", "Ljava.lang.Object;", 0x4, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "ELEMENT_NULL_", NULL, 0x1a, "Ljava.lang.String;", &ComThoughtworksXstreamConvertersReflectionSerializableConverter_ELEMENT_NULL_,  },
    { "ELEMENT_DEFAULT_", NULL, 0x1a, "Ljava.lang.String;", &ComThoughtworksXstreamConvertersReflectionSerializableConverter_ELEMENT_DEFAULT_,  },
    { "ELEMENT_UNSERIALIZABLE_PARENTS_", NULL, 0x1a, "Ljava.lang.String;", &ComThoughtworksXstreamConvertersReflectionSerializableConverter_ELEMENT_UNSERIALIZABLE_PARENTS_,  },
    { "ATTRIBUTE_CLASS_", NULL, 0x1a, "Ljava.lang.String;", &ComThoughtworksXstreamConvertersReflectionSerializableConverter_ATTRIBUTE_CLASS_,  },
    { "ATTRIBUTE_SERIALIZATION_", NULL, 0x1a, "Ljava.lang.String;", &ComThoughtworksXstreamConvertersReflectionSerializableConverter_ATTRIBUTE_SERIALIZATION_,  },
    { "ATTRIBUTE_VALUE_CUSTOM_", NULL, 0x1a, "Ljava.lang.String;", &ComThoughtworksXstreamConvertersReflectionSerializableConverter_ATTRIBUTE_VALUE_CUSTOM_,  },
    { "ELEMENT_FIELDS_", NULL, 0x1a, "Ljava.lang.String;", &ComThoughtworksXstreamConvertersReflectionSerializableConverter_ELEMENT_FIELDS_,  },
    { "ELEMENT_FIELD_", NULL, 0x1a, "Ljava.lang.String;", &ComThoughtworksXstreamConvertersReflectionSerializableConverter_ELEMENT_FIELD_,  },
    { "ATTRIBUTE_NAME_", NULL, 0x1a, "Ljava.lang.String;", &ComThoughtworksXstreamConvertersReflectionSerializableConverter_ATTRIBUTE_NAME_,  },
    { "classLoaderReference_", NULL, 0x12, "Lcom.thoughtworks.xstream.core.ClassLoaderReference;", NULL,  },
  };
  static const J2ObjcClassInfo _ComThoughtworksXstreamConvertersReflectionSerializableConverter = { "SerializableConverter", "com.thoughtworks.xstream.converters.reflection", NULL, 0x1, 12, methods, 10, fields, 0, NULL};
  return &_ComThoughtworksXstreamConvertersReflectionSerializableConverter;
}

@end


#line 482
@implementation ComThoughtworksXstreamConvertersReflectionSerializableConverter_UnserializableParentsReflectionProvider

- (instancetype)initWithComThoughtworksXstreamConvertersReflectionReflectionProvider:(id<ComThoughtworksXstreamConvertersReflectionReflectionProvider>)reflectionProvider {
  return
#line 485
  [super initWithComThoughtworksXstreamConvertersReflectionReflectionProvider:reflectionProvider];
}


#line 488
- (void)visitSerializableFieldsWithId:(id)object
withComThoughtworksXstreamConvertersReflectionReflectionProvider_Visitor:(id<ComThoughtworksXstreamConvertersReflectionReflectionProvider_Visitor>)visitor {
  
#line 489
  [((id<ComThoughtworksXstreamConvertersReflectionReflectionProvider>) nil_chk(wrapped_)) visitSerializableFieldsWithId:object withComThoughtworksXstreamConvertersReflectionReflectionProvider_Visitor:[[ComThoughtworksXstreamConvertersReflectionSerializableConverter_UnserializableParentsReflectionProvider_$1 alloc] initWithComThoughtworksXstreamConvertersReflectionReflectionProvider_Visitor:visitor]];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithComThoughtworksXstreamConvertersReflectionReflectionProvider:", "UnserializableParentsReflectionProvider", NULL, 0x1, NULL },
    { "visitSerializableFieldsWithId:withComThoughtworksXstreamConvertersReflectionReflectionProvider_Visitor:", "visitSerializableFields", "V", 0x1, NULL },
  };
  static const J2ObjcClassInfo _ComThoughtworksXstreamConvertersReflectionSerializableConverter_UnserializableParentsReflectionProvider = { "UnserializableParentsReflectionProvider", "com.thoughtworks.xstream.converters.reflection", "SerializableConverter", 0xa, 2, methods, 0, NULL, 0, NULL};
  return &_ComThoughtworksXstreamConvertersReflectionSerializableConverter_UnserializableParentsReflectionProvider;
}

@end

@implementation ComThoughtworksXstreamConvertersReflectionSerializableConverter_UnserializableParentsReflectionProvider_$1


#line 490
- (void)visitWithNSString:(NSString *)name
             withIOSClass:(IOSClass *)type
             withIOSClass:(IOSClass *)definedIn
                   withId:(id)value {
  
#line 491
  if (![[IOSClass classWithProtocol:@protocol(JavaIoSerializable)] isAssignableFrom:definedIn]) {
    [((id<ComThoughtworksXstreamConvertersReflectionReflectionProvider_Visitor>) nil_chk(val$visitor_)) visitWithNSString:name withIOSClass:type withIOSClass:definedIn withId:value];
  }
}

- (instancetype)initWithComThoughtworksXstreamConvertersReflectionReflectionProvider_Visitor:(id<ComThoughtworksXstreamConvertersReflectionReflectionProvider_Visitor>)capture$0 {
  val$visitor_ = capture$0;
  return [super init];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "visitWithNSString:withIOSClass:withIOSClass:withId:", "visit", "V", 0x1, NULL },
    { "initWithComThoughtworksXstreamConvertersReflectionReflectionProvider_Visitor:", "init", NULL, 0x0, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "val$visitor_", NULL, 0x1012, "Lcom.thoughtworks.xstream.converters.reflection.ReflectionProvider$Visitor;", NULL,  },
  };
  static const J2ObjcClassInfo _ComThoughtworksXstreamConvertersReflectionSerializableConverter_UnserializableParentsReflectionProvider_$1 = { "$1", "com.thoughtworks.xstream.converters.reflection", "SerializableConverter$UnserializableParentsReflectionProvider", 0x8000, 2, methods, 1, fields, 0, NULL};
  return &_ComThoughtworksXstreamConvertersReflectionSerializableConverter_UnserializableParentsReflectionProvider_$1;
}

@end

@implementation ComThoughtworksXstreamConvertersReflectionSerializableConverter_$1


#line 134
- (void)writeToStreamWithId:(id)object {
  
#line 135
  if (object == nil) {
    [((id<ComThoughtworksXstreamIoHierarchicalStreamWriter>) nil_chk(val$writer_)) startNodeWithNSString:ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ELEMENT_NULL_()];
    [val$writer_ endNode];
  }
  else {
    
#line 139
    [ComThoughtworksXstreamIoExtendedHierarchicalStreamWriterHelper startNodeWithComThoughtworksXstreamIoHierarchicalStreamWriter:val$writer_ withNSString:[((id<ComThoughtworksXstreamMapperMapper>) nil_chk(this$0_->mapper_)) serializedClassWithIOSClass:[object getClass]] withIOSClass:[object getClass]];
    [((id<ComThoughtworksXstreamConvertersMarshallingContext>) nil_chk(val$context_)) convertAnotherWithId:object];
    [((id<ComThoughtworksXstreamIoHierarchicalStreamWriter>) nil_chk(val$writer_)) endNode];
  }
}


#line 145
- (void)writeFieldsToStreamWithJavaUtilMap:(id<JavaUtilMap>)fields {
  
#line 146
  JavaIoObjectStreamClass *objectStreamClass = [JavaIoObjectStreamClass lookupWithIOSClass:IOSObjectArray_Get(nil_chk(val$currentType_), 0)];
  
#line 148
  [((id<ComThoughtworksXstreamIoHierarchicalStreamWriter>) nil_chk(val$writer_)) startNodeWithNSString:ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ELEMENT_DEFAULT_()];
  for (id<JavaUtilIterator> iterator = [((id<JavaUtilSet>) nil_chk([((id<JavaUtilMap>) nil_chk(fields)) keySet])) iterator]; [((id<JavaUtilIterator>) nil_chk(iterator)) hasNext]; ) {
    NSString *name = (NSString *) check_class_cast([iterator next], [NSString class]);
    if (![((id<ComThoughtworksXstreamMapperMapper>) nil_chk(this$0_->mapper_)) shouldSerializeMemberWithIOSClass:IOSObjectArray_Get(val$currentType_, 0) withNSString:name]) {
      continue;
    }
    JavaIoObjectStreamField *field = [((JavaIoObjectStreamClass *) nil_chk(objectStreamClass)) getFieldWithNSString:name];
    id value = [fields getWithId:name];
    if (field == nil) {
      @throw [[ComThoughtworksXstreamConvertersReflectionObjectAccessException alloc] initWithNSString:JreStrcat("$$$$C", @"Class ", [[nil_chk(value) getClass] getName], @" may not write a field named '",
#line 158
      name, '\'')];
    }
    if (value != nil) {
      [ComThoughtworksXstreamIoExtendedHierarchicalStreamWriterHelper startNodeWithComThoughtworksXstreamIoHierarchicalStreamWriter:val$writer_ withNSString:
#line 162
      [this$0_->mapper_ serializedMemberWithIOSClass:[nil_chk(val$source_) getClass] withNSString:name] withIOSClass:
#line 163
      [value getClass]];
      if ([((JavaIoObjectStreamField *) nil_chk(field)) getType] != [value getClass] && ![((IOSClass *) nil_chk([field getType])) isPrimitive]) {
        NSString *attributeName = [this$0_->mapper_ aliasForSystemAttributeWithNSString:ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ATTRIBUTE_CLASS_()];
        if (attributeName != nil) {
          [val$writer_ addAttributeWithNSString:attributeName withNSString:[this$0_->mapper_ serializedClassWithIOSClass:[value getClass]]];
        }
      }
      [((id<ComThoughtworksXstreamConvertersMarshallingContext>) nil_chk(val$context_)) convertAnotherWithId:value];
      [val$writer_ endNode];
    }
  }
  [val$writer_ endNode];
}


#line 177
- (void)defaultWriteObject {
  
#line 178
  jboolean writtenDefaultFields = NO;
  
#line 180
  JavaIoObjectStreamClass *objectStreamClass = [JavaIoObjectStreamClass lookupWithIOSClass:IOSObjectArray_Get(nil_chk(val$currentType_), 0)];
  
#line 182
  if (objectStreamClass == nil) {
    return;
  }
  
#line 186
  IOSObjectArray *fields = [((JavaIoObjectStreamClass *) nil_chk(objectStreamClass)) getFields];
  for (jint i = 0; i < ((IOSObjectArray *) nil_chk(fields))->size_; i++) {
    JavaIoObjectStreamField *field = IOSObjectArray_Get(fields, i);
    id value = [this$0_ readFieldWithJavaIoObjectStreamField:field withIOSClass:IOSObjectArray_Get(val$currentType_, 0) withId:val$source_];
    if (value != nil) {
      if (!IOSBooleanArray_Get(nil_chk(val$writtenClassWrapper_), 0)) {
        [((id<ComThoughtworksXstreamIoHierarchicalStreamWriter>) nil_chk(val$writer_)) startNodeWithNSString:[((id<ComThoughtworksXstreamMapperMapper>) nil_chk(this$0_->mapper_)) serializedClassWithIOSClass:IOSObjectArray_Get(val$currentType_, 0)]];
        *IOSBooleanArray_GetRef(val$writtenClassWrapper_, 0) = YES;
      }
      if (!writtenDefaultFields) {
        [((id<ComThoughtworksXstreamIoHierarchicalStreamWriter>) nil_chk(val$writer_)) startNodeWithNSString:ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ELEMENT_DEFAULT_()];
        writtenDefaultFields = YES;
      }
      if (![((id<ComThoughtworksXstreamMapperMapper>) nil_chk(this$0_->mapper_)) shouldSerializeMemberWithIOSClass:IOSObjectArray_Get(val$currentType_, 0) withNSString:[((JavaIoObjectStreamField *) nil_chk(field)) getName]]) {
        continue;
      }
      
#line 203
      IOSClass *actualType = [value getClass];
      [ComThoughtworksXstreamIoExtendedHierarchicalStreamWriterHelper startNodeWithComThoughtworksXstreamIoHierarchicalStreamWriter:val$writer_ withNSString:
#line 205
      [this$0_->mapper_ serializedMemberWithIOSClass:[nil_chk(val$source_) getClass] withNSString:[field getName]] withIOSClass:actualType];
      IOSClass *defaultType = [this$0_->mapper_ defaultImplementationOfWithIOSClass:[field getType]];
      if (![actualType isEqual:defaultType]) {
        NSString *attributeName = [this$0_->mapper_ aliasForSystemAttributeWithNSString:ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ATTRIBUTE_CLASS_()];
        if (attributeName != nil) {
          [((id<ComThoughtworksXstreamIoHierarchicalStreamWriter>) nil_chk(val$writer_)) addAttributeWithNSString:attributeName withNSString:[this$0_->mapper_ serializedClassWithIOSClass:actualType]];
        }
      }
      
#line 214
      [((id<ComThoughtworksXstreamConvertersMarshallingContext>) nil_chk(val$context_)) convertAnotherWithId:value];
      
#line 216
      [((id<ComThoughtworksXstreamIoHierarchicalStreamWriter>) nil_chk(val$writer_)) endNode];
    }
  }
  if (IOSBooleanArray_Get(nil_chk(val$writtenClassWrapper_), 0) && !writtenDefaultFields) {
    [((id<ComThoughtworksXstreamIoHierarchicalStreamWriter>) nil_chk(val$writer_)) startNodeWithNSString:ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ELEMENT_DEFAULT_()];
    [val$writer_ endNode];
  }
  else
#line 222
  if (writtenDefaultFields) {
    [((id<ComThoughtworksXstreamIoHierarchicalStreamWriter>) nil_chk(val$writer_)) endNode];
  }
}


#line 227
- (void)flush {
  
#line 228
  [((id<ComThoughtworksXstreamIoHierarchicalStreamWriter>) nil_chk(val$writer_)) flush];
}


#line 231
- (void)close {
  
#line 232
  @throw [[JavaLangUnsupportedOperationException alloc] initWithNSString:@"Objects are not allowed to call ObjectOutputStream.close() from writeObject()"];
}

- (instancetype)initWithComThoughtworksXstreamConvertersReflectionSerializableConverter:(ComThoughtworksXstreamConvertersReflectionSerializableConverter *)outer$
                                   withComThoughtworksXstreamIoHierarchicalStreamWriter:(id<ComThoughtworksXstreamIoHierarchicalStreamWriter>)capture$0
                                 withComThoughtworksXstreamConvertersMarshallingContext:(id<ComThoughtworksXstreamConvertersMarshallingContext>)capture$1
                                                                      withIOSClassArray:(IOSObjectArray *)capture$2
                                                                                 withId:(id)capture$3
                                                                       withBooleanArray:(IOSBooleanArray *)capture$4 {
  this$0_ = outer$;
  val$writer_ = capture$0;
  val$context_ = capture$1;
  val$currentType_ = capture$2;
  val$source_ = capture$3;
  val$writtenClassWrapper_ = capture$4;
  return [super init];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "writeToStreamWithId:", "writeToStream", "V", 0x1, NULL },
    { "writeFieldsToStreamWithJavaUtilMap:", "writeFieldsToStream", "V", 0x1, NULL },
    { "defaultWriteObject", NULL, "V", 0x1, NULL },
    { "flush", NULL, "V", 0x1, NULL },
    { "close", NULL, "V", 0x1, NULL },
    { "initWithComThoughtworksXstreamConvertersReflectionSerializableConverter:withComThoughtworksXstreamIoHierarchicalStreamWriter:withComThoughtworksXstreamConvertersMarshallingContext:withIOSClassArray:withId:withBooleanArray:", "init", NULL, 0x0, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lcom.thoughtworks.xstream.converters.reflection.SerializableConverter;", NULL,  },
    { "val$writer_", NULL, 0x1012, "Lcom.thoughtworks.xstream.io.HierarchicalStreamWriter;", NULL,  },
    { "val$context_", NULL, 0x1012, "Lcom.thoughtworks.xstream.converters.MarshallingContext;", NULL,  },
    { "val$currentType_", NULL, 0x1012, "[Ljava.lang.Class;", NULL,  },
    { "val$source_", NULL, 0x1012, "Ljava.lang.Object;", NULL,  },
    { "val$writtenClassWrapper_", NULL, 0x1012, "[Z", NULL,  },
  };
  static const J2ObjcClassInfo _ComThoughtworksXstreamConvertersReflectionSerializableConverter_$1 = { "$1", "com.thoughtworks.xstream.converters.reflection", "SerializableConverter", 0x8000, 6, methods, 6, fields, 0, NULL};
  return &_ComThoughtworksXstreamConvertersReflectionSerializableConverter_$1;
}

@end

@implementation ComThoughtworksXstreamConvertersReflectionSerializableConverter_$2


#line 337
- (id)readFromStream {
  
#line 338
  [((id<ComThoughtworksXstreamIoHierarchicalStreamReader>) nil_chk(val$reader_)) moveDown];
  IOSClass *type = [ComThoughtworksXstreamCoreUtilHierarchicalStreams readClassTypeWithComThoughtworksXstreamIoHierarchicalStreamReader:val$reader_ withComThoughtworksXstreamMapperMapper:this$0_->mapper_];
  id value = [((id<ComThoughtworksXstreamConvertersUnmarshallingContext>) nil_chk(val$context_)) convertAnotherWithId:val$result_ withIOSClass:type];
  [val$reader_ moveUp];
  return value;
}


#line 345
- (id<JavaUtilMap>)readFieldsFromStream {
  
#line 346
  id<JavaUtilMap> fields = [[JavaUtilHashMap alloc] init];
  [((id<ComThoughtworksXstreamIoHierarchicalStreamReader>) nil_chk(val$reader_)) moveDown];
  if ([((NSString *) nil_chk([val$reader_ getNodeName])) isEqual:ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ELEMENT_FIELDS_()]) {
    
#line 350
    while ([val$reader_ hasMoreChildren]) {
      [val$reader_ moveDown];
      if (![((NSString *) nil_chk([val$reader_ getNodeName])) isEqual:ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ELEMENT_FIELD_()]) {
        @throw [[ComThoughtworksXstreamConvertersConversionException alloc] initWithNSString:JreStrcat("$$$$$", @"Expected <", ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ELEMENT_FIELD_(), @"/> element inside <", ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ELEMENT_FIELD_(), @"/>")];
      }
      NSString *name = [val$reader_ getAttributeWithNSString:ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ATTRIBUTE_NAME_()];
      IOSClass *type = [((id<ComThoughtworksXstreamMapperMapper>) nil_chk(this$0_->mapper_)) realClassWithNSString:[val$reader_ getAttributeWithNSString:ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ATTRIBUTE_CLASS_()]];
      id value = [((id<ComThoughtworksXstreamConvertersUnmarshallingContext>) nil_chk(val$context_)) convertAnotherWithId:val$result_ withIOSClass:type];
      (void) [fields putWithId:name withId:value];
      [val$reader_ moveUp];
    }
  }
  else
#line 361
  if ([((NSString *) nil_chk([val$reader_ getNodeName])) isEqual:ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ELEMENT_DEFAULT_()]) {
    
#line 363
    JavaIoObjectStreamClass *objectStreamClass = [JavaIoObjectStreamClass lookupWithIOSClass:IOSObjectArray_Get(nil_chk(val$currentType_), 0)];
    while ([val$reader_ hasMoreChildren]) {
      [val$reader_ moveDown];
      NSString *name = [((id<ComThoughtworksXstreamMapperMapper>) nil_chk(this$0_->mapper_)) realMemberWithIOSClass:IOSObjectArray_Get(val$currentType_, 0) withNSString:[val$reader_ getNodeName]];
      if ([this$0_->mapper_ shouldSerializeMemberWithIOSClass:IOSObjectArray_Get(val$currentType_, 0) withNSString:name]) {
        NSString *classAttribute = [ComThoughtworksXstreamCoreUtilHierarchicalStreams readClassAttributeWithComThoughtworksXstreamIoHierarchicalStreamReader:val$reader_ withComThoughtworksXstreamMapperMapper:this$0_->mapper_];
        IOSClass *type;
        if (classAttribute != nil) {
          type = [this$0_->mapper_ realClassWithNSString:classAttribute];
        }
        else {
          
#line 373
          JavaIoObjectStreamField *field = [((JavaIoObjectStreamClass *) nil_chk(objectStreamClass)) getFieldWithNSString:name];
          if (field == nil) {
            @throw [[ComThoughtworksXstreamConvertersReflectionMissingFieldException alloc] initWithNSString:[((IOSClass *) nil_chk(IOSObjectArray_Get(val$currentType_, 0))) getName] withNSString:name];
          }
          type = [((JavaIoObjectStreamField *) nil_chk(field)) getType];
        }
        id value = [((id<ComThoughtworksXstreamConvertersUnmarshallingContext>) nil_chk(val$context_)) convertAnotherWithId:val$result_ withIOSClass:type];
        (void) [fields putWithId:name withId:value];
      }
      [val$reader_ moveUp];
    }
  }
  else {
    
#line 385
    @throw [[ComThoughtworksXstreamConvertersConversionException alloc] initWithNSString:JreStrcat("$$$$$", @"Expected <", ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ELEMENT_FIELDS_(), @"/> or <", ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ELEMENT_DEFAULT_(), @"/> element when calling ObjectInputStream.readFields()")];
  }
  
#line 388
  [val$reader_ moveUp];
  return fields;
}


#line 392
- (void)defaultReadObject {
  
#line 393
  if (![((id<ComThoughtworksXstreamIoHierarchicalStreamReader>) nil_chk(val$reader_)) hasMoreChildren]) {
    return;
  }
  [val$reader_ moveDown];
  if (![((NSString *) nil_chk([val$reader_ getNodeName])) isEqual:ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ELEMENT_DEFAULT_()]) {
    @throw [[ComThoughtworksXstreamConvertersConversionException alloc] initWithNSString:JreStrcat("$$$", @"Expected <", ComThoughtworksXstreamConvertersReflectionSerializableConverter_get_ELEMENT_DEFAULT_(), @"/> element in readObject() stream")];
  }
  while ([val$reader_ hasMoreChildren]) {
    [val$reader_ moveDown];
    
#line 403
    NSString *fieldName = [((id<ComThoughtworksXstreamMapperMapper>) nil_chk(this$0_->mapper_)) realMemberWithIOSClass:IOSObjectArray_Get(nil_chk(val$currentType_), 0) withNSString:[val$reader_ getNodeName]];
    if ([this$0_->mapper_ shouldSerializeMemberWithIOSClass:IOSObjectArray_Get(val$currentType_, 0) withNSString:fieldName]) {
      NSString *classAttribute = [ComThoughtworksXstreamCoreUtilHierarchicalStreams readClassAttributeWithComThoughtworksXstreamIoHierarchicalStreamReader:val$reader_ withComThoughtworksXstreamMapperMapper:this$0_->mapper_];
      IOSClass *type;
      if (classAttribute != nil) {
        type = [this$0_->mapper_ realClassWithNSString:classAttribute];
      }
      else {
        
#line 410
        type = [this$0_->mapper_ defaultImplementationOfWithIOSClass:[((id<ComThoughtworksXstreamConvertersReflectionReflectionProvider>) nil_chk(this$0_->reflectionProvider_)) getFieldTypeWithId:val$result_ withNSString:fieldName withIOSClass:IOSObjectArray_Get(val$currentType_, 0)]];
      }
      
#line 413
      id value = [((id<ComThoughtworksXstreamConvertersUnmarshallingContext>) nil_chk(val$context_)) convertAnotherWithId:val$result_ withIOSClass:type];
      [((id<ComThoughtworksXstreamConvertersReflectionReflectionProvider>) nil_chk(this$0_->reflectionProvider_)) writeFieldWithId:val$result_ withNSString:fieldName withId:value withIOSClass:IOSObjectArray_Get(val$currentType_, 0)];
    }
    
#line 417
    [val$reader_ moveUp];
  }
  [val$reader_ moveUp];
}


#line 422
- (void)registerValidationWithJavaIoObjectInputValidation:(id<JavaIoObjectInputValidation>)validation
                                                  withInt:(jint)priority {
  
#line 423
  [((id<ComThoughtworksXstreamConvertersUnmarshallingContext>) nil_chk(val$context_)) addCompletionCallbackWithJavaLangRunnable:[[ComThoughtworksXstreamConvertersReflectionSerializableConverter_$2_$1 alloc] initWithJavaIoObjectInputValidation:validation] withInt:
#line 431
  priority];
}


#line 434
- (void)close {
  
#line 435
  @throw [[JavaLangUnsupportedOperationException alloc] initWithNSString:@"Objects are not allowed to call ObjectInputStream.close() from readObject()"];
}

- (instancetype)initWithComThoughtworksXstreamConvertersReflectionSerializableConverter:(ComThoughtworksXstreamConvertersReflectionSerializableConverter *)outer$
                                   withComThoughtworksXstreamIoHierarchicalStreamReader:(id<ComThoughtworksXstreamIoHierarchicalStreamReader>)capture$0
                               withComThoughtworksXstreamConvertersUnmarshallingContext:(id<ComThoughtworksXstreamConvertersUnmarshallingContext>)capture$1
                                                                                 withId:(id)capture$2
                                                                      withIOSClassArray:(IOSObjectArray *)capture$3 {
  this$0_ = outer$;
  val$reader_ = capture$0;
  val$context_ = capture$1;
  val$result_ = capture$2;
  val$currentType_ = capture$3;
  return [super init];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "readFromStream", NULL, "Ljava.lang.Object;", 0x1, NULL },
    { "readFieldsFromStream", NULL, "Ljava.util.Map;", 0x1, NULL },
    { "defaultReadObject", NULL, "V", 0x1, NULL },
    { "registerValidationWithJavaIoObjectInputValidation:withInt:", "registerValidation", "V", 0x1, NULL },
    { "close", NULL, "V", 0x1, NULL },
    { "initWithComThoughtworksXstreamConvertersReflectionSerializableConverter:withComThoughtworksXstreamIoHierarchicalStreamReader:withComThoughtworksXstreamConvertersUnmarshallingContext:withId:withIOSClassArray:", "init", NULL, 0x0, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "this$0_", NULL, 0x1012, "Lcom.thoughtworks.xstream.converters.reflection.SerializableConverter;", NULL,  },
    { "val$reader_", NULL, 0x1012, "Lcom.thoughtworks.xstream.io.HierarchicalStreamReader;", NULL,  },
    { "val$context_", NULL, 0x1012, "Lcom.thoughtworks.xstream.converters.UnmarshallingContext;", NULL,  },
    { "val$result_", NULL, 0x1012, "Ljava.lang.Object;", NULL,  },
    { "val$currentType_", NULL, 0x1012, "[Ljava.lang.Class;", NULL,  },
  };
  static const J2ObjcClassInfo _ComThoughtworksXstreamConvertersReflectionSerializableConverter_$2 = { "$2", "com.thoughtworks.xstream.converters.reflection", "SerializableConverter", 0x8000, 6, methods, 5, fields, 0, NULL};
  return &_ComThoughtworksXstreamConvertersReflectionSerializableConverter_$2;
}

@end

@implementation ComThoughtworksXstreamConvertersReflectionSerializableConverter_$2_$1


#line 424
- (void)run {
  
#line 425
  @try {
    [((id<JavaIoObjectInputValidation>) nil_chk(val$validation_)) validateObject];
  }
  @catch (
#line 427
  JavaIoInvalidObjectException *e) {
    @throw [[ComThoughtworksXstreamConvertersReflectionObjectAccessException alloc] initWithNSString:JreStrcat("$$", @"Cannot validate object : ", [((JavaIoInvalidObjectException *) nil_chk(e)) getMessage]) withJavaLangThrowable:e];
  }
}

- (instancetype)initWithJavaIoObjectInputValidation:(id<JavaIoObjectInputValidation>)capture$0 {
  val$validation_ = capture$0;
  return [super init];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "run", NULL, "V", 0x1, NULL },
    { "initWithJavaIoObjectInputValidation:", "init", NULL, 0x0, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "val$validation_", NULL, 0x1012, "Ljava.io.ObjectInputValidation;", NULL,  },
  };
  static const J2ObjcClassInfo _ComThoughtworksXstreamConvertersReflectionSerializableConverter_$2_$1 = { "$1", "com.thoughtworks.xstream.converters.reflection", "SerializableConverter$$2", 0x8000, 2, methods, 1, fields, 0, NULL};
  return &_ComThoughtworksXstreamConvertersReflectionSerializableConverter_$2_$1;
}

@end
