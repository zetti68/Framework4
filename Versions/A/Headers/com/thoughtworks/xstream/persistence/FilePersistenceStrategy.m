//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/Zetzsche/Development/SimarisCurves/com.thoughtworks.xstream/bin/src/com/thoughtworks/xstream/persistence/FilePersistenceStrategy.java
//


#line 1 "/Users/Zetzsche/Development/SimarisCurves/com.thoughtworks.xstream/bin/src/com/thoughtworks/xstream/persistence/FilePersistenceStrategy.java"

#include "IOSClass.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "com/thoughtworks/xstream/XStream.h"
#include "com/thoughtworks/xstream/converters/Converter.h"
#include "com/thoughtworks/xstream/converters/ConverterLookup.h"
#include "com/thoughtworks/xstream/converters/SingleValueConverter.h"
#include "com/thoughtworks/xstream/io/StreamException.h"
#include "com/thoughtworks/xstream/io/xml/DomDriver.h"
#include "com/thoughtworks/xstream/mapper/Mapper.h"
#include "com/thoughtworks/xstream/persistence/AbstractFilePersistenceStrategy.h"
#include "com/thoughtworks/xstream/persistence/FilePersistenceStrategy.h"
#include "java/io/File.h"
#include "java/lang/Integer.h"
#include "java/lang/StringBuffer.h"

@interface ComThoughtworksXstreamPersistenceFilePersistenceStrategy () {
 @public
  NSString *illegalChars_;
}

@end

J2OBJC_FIELD_SETTER(ComThoughtworksXstreamPersistenceFilePersistenceStrategy, illegalChars_, NSString *)


#line 34
@implementation ComThoughtworksXstreamPersistenceFilePersistenceStrategy


#line 45
- (instancetype)initWithJavaIoFile:(JavaIoFile *)baseDirectory {
  ComThoughtworksXstreamPersistenceFilePersistenceStrategy_initWithJavaIoFile_(self, baseDirectory);
  return self;
}


#line 56
- (instancetype)initWithJavaIoFile:(JavaIoFile *)baseDirectory
 withComThoughtworksXstreamXStream:(ComThoughtworksXstreamXStream *)xstream {
  ComThoughtworksXstreamPersistenceFilePersistenceStrategy_initWithJavaIoFile_withComThoughtworksXstreamXStream_(self, baseDirectory, xstream);
  return self;
}


#line 71
- (instancetype)initWithJavaIoFile:(JavaIoFile *)baseDirectory
 withComThoughtworksXstreamXStream:(ComThoughtworksXstreamXStream *)xstream
                      withNSString:(NSString *)encoding
                      withNSString:(NSString *)illegalChars {
  ComThoughtworksXstreamPersistenceFilePersistenceStrategy_initWithJavaIoFile_withComThoughtworksXstreamXStream_withNSString_withNSString_(self, baseDirectory, xstream, encoding, illegalChars);
  return self;
}


#line 78
- (jboolean)isValidWithJavaIoFile:(JavaIoFile *)dir
                     withNSString:(NSString *)name {
  return [super isValidWithJavaIoFile:dir withNSString:name] && [((NSString *) nil_chk(name)) indexOf:'@'] > 0;
}


#line 88
- (id)extractKeyWithNSString:(NSString *)name {
  NSString *key = [self unescapeWithNSString:[name substring:0 endIndex:((jint) [((NSString *) nil_chk(name)) length]) - 4]];
  if ([@"null@null" isEqual:key]) {
    return nil;
  }
  jint idx = [((NSString *) nil_chk(key)) indexOf:'@'];
  if (idx < 0) {
    @throw new_ComThoughtworksXstreamIoStreamException_initWithNSString_(JreStrcat("$$", @"Not a valid key: ", key));
  }
  IOSClass *type = [((id<ComThoughtworksXstreamMapperMapper>) nil_chk([self getMapper])) realClassWithNSString:[key substring:0 endIndex:idx]];
  id<ComThoughtworksXstreamConvertersConverter> converter = [((id<ComThoughtworksXstreamConvertersConverterLookup>) nil_chk([self getConverterLookup])) lookupConverterForTypeWithIOSClass:type];
  if ([ComThoughtworksXstreamConvertersSingleValueConverter_class_() isInstance:converter]) {
    id<ComThoughtworksXstreamConvertersSingleValueConverter> svConverter = (id<ComThoughtworksXstreamConvertersSingleValueConverter>) check_protocol_cast(converter, @protocol(ComThoughtworksXstreamConvertersSingleValueConverter));
    return [((id<ComThoughtworksXstreamConvertersSingleValueConverter>) nil_chk(svConverter)) fromStringWithNSString:[key substring:idx + 1]];
  }
  else {
    
#line 103
    @throw new_ComThoughtworksXstreamIoStreamException_initWithNSString_(JreStrcat("$$$", @"No SingleValueConverter for type ",
#line 104
    [((IOSClass *) nil_chk(type)) getName], @" available"));
  }
}


#line 109
- (NSString *)unescapeWithNSString:(NSString *)name {
  JavaLangStringBuffer *buffer = new_JavaLangStringBuffer_init();
  for (jint idx = [((NSString *) nil_chk(name)) indexOf:'%']; idx >= 0; idx = [((NSString *) nil_chk(name)) indexOf:'%']) {
    (void) [buffer appendWithNSString:[name substring:0 endIndex:idx]];
    jint c = JavaLangInteger_parseIntWithNSString_withInt_([name substring:idx + 1 endIndex:idx + 3], 16);
    (void) [buffer appendWithChar:(jchar) c];
    name = [name substring:idx + 3];
  }
  (void) [buffer appendWithNSString:name];
  return [buffer description];
}


#line 127
- (NSString *)getNameWithId:(id)key {
  if (key == nil) {
    return @"null@null.xml";
  }
  IOSClass *type = [nil_chk(key) getClass];
  id<ComThoughtworksXstreamConvertersConverter> converter = [((id<ComThoughtworksXstreamConvertersConverterLookup>) nil_chk([self getConverterLookup])) lookupConverterForTypeWithIOSClass:type];
  if ([ComThoughtworksXstreamConvertersSingleValueConverter_class_() isInstance:converter]) {
    id<ComThoughtworksXstreamConvertersSingleValueConverter> svConverter = (id<ComThoughtworksXstreamConvertersSingleValueConverter>) check_protocol_cast(converter, @protocol(ComThoughtworksXstreamConvertersSingleValueConverter));
    return JreStrcat("$C$$", [((id<ComThoughtworksXstreamMapperMapper>) nil_chk([self getMapper])) serializedClassWithIOSClass:type], '@',
#line 137
    [self escapeWithNSString:[((id<ComThoughtworksXstreamConvertersSingleValueConverter>) nil_chk(svConverter)) toStringWithId:key]], @".xml");
  }
  else {
    @throw new_ComThoughtworksXstreamIoStreamException_initWithNSString_(JreStrcat("$$$", @"No SingleValueConverter for type ",
#line 141
    [type getName], @" available"));
  }
}

- (NSString *)escapeWithNSString:(NSString *)key {
  JavaLangStringBuffer *buffer = new_JavaLangStringBuffer_init();
  IOSCharArray *array = [((NSString *) nil_chk(key)) toCharArray];
  for (jint i = 0; i < ((IOSCharArray *) nil_chk(array))->size_; i++) {
    jchar c = IOSCharArray_Get(array, i);
    if (c >= ' ' && [((NSString *) nil_chk(illegalChars_)) indexOf:c] < 0) {
      (void) [buffer appendWithChar:c];
    }
    else {
      
#line 154
      (void) [buffer appendWithNSString:JreStrcat("C$", '%', [((NSString *) nil_chk(JavaLangInteger_toHexStringWithInt_(c))) uppercaseString])];
    }
  }
  return [buffer description];
}

+ (const J2ObjcClassInfo *)__metadata {
  static const J2ObjcMethodInfo methods[] = {
    { "initWithJavaIoFile:", "FilePersistenceStrategy", NULL, 0x1, NULL, NULL },
    { "initWithJavaIoFile:withComThoughtworksXstreamXStream:", "FilePersistenceStrategy", NULL, 0x1, NULL, NULL },
    { "initWithJavaIoFile:withComThoughtworksXstreamXStream:withNSString:withNSString:", "FilePersistenceStrategy", NULL, 0x1, NULL, NULL },
    { "isValidWithJavaIoFile:withNSString:", "isValid", "Z", 0x4, NULL, NULL },
    { "extractKeyWithNSString:", "extractKey", "Ljava.lang.Object;", 0x4, NULL, NULL },
    { "unescapeWithNSString:", "unescape", "Ljava.lang.String;", 0x4, NULL, NULL },
    { "getNameWithId:", "getName", "Ljava.lang.String;", 0x4, NULL, NULL },
    { "escapeWithNSString:", "escape", "Ljava.lang.String;", 0x4, NULL, NULL },
  };
  static const J2ObjcFieldInfo fields[] = {
    { "illegalChars_", NULL, 0x12, "Ljava.lang.String;", NULL, NULL,  },
  };
  static const J2ObjcClassInfo _ComThoughtworksXstreamPersistenceFilePersistenceStrategy = { 2, "FilePersistenceStrategy", "com.thoughtworks.xstream.persistence", NULL, 0x1, 8, methods, 1, fields, 0, NULL, 0, NULL, NULL, NULL };
  return &_ComThoughtworksXstreamPersistenceFilePersistenceStrategy;
}

@end


#line 45
void ComThoughtworksXstreamPersistenceFilePersistenceStrategy_initWithJavaIoFile_(ComThoughtworksXstreamPersistenceFilePersistenceStrategy *self, JavaIoFile *baseDirectory) {
  (void) ComThoughtworksXstreamPersistenceFilePersistenceStrategy_initWithJavaIoFile_withComThoughtworksXstreamXStream_(self, baseDirectory, new_ComThoughtworksXstreamXStream_initWithComThoughtworksXstreamIoHierarchicalStreamDriver_(new_ComThoughtworksXstreamIoXmlDomDriver_init()));
}


#line 45
ComThoughtworksXstreamPersistenceFilePersistenceStrategy *new_ComThoughtworksXstreamPersistenceFilePersistenceStrategy_initWithJavaIoFile_(JavaIoFile *baseDirectory) {
  ComThoughtworksXstreamPersistenceFilePersistenceStrategy *self = [ComThoughtworksXstreamPersistenceFilePersistenceStrategy alloc];
  ComThoughtworksXstreamPersistenceFilePersistenceStrategy_initWithJavaIoFile_(self, baseDirectory);
  return self;
}


#line 56
void ComThoughtworksXstreamPersistenceFilePersistenceStrategy_initWithJavaIoFile_withComThoughtworksXstreamXStream_(ComThoughtworksXstreamPersistenceFilePersistenceStrategy *self, JavaIoFile *baseDirectory, ComThoughtworksXstreamXStream *xstream) {
  (void) ComThoughtworksXstreamPersistenceFilePersistenceStrategy_initWithJavaIoFile_withComThoughtworksXstreamXStream_withNSString_withNSString_(self, baseDirectory, xstream, @"utf-8", @"<>?:/\\\"|*%");
}


#line 56
ComThoughtworksXstreamPersistenceFilePersistenceStrategy *new_ComThoughtworksXstreamPersistenceFilePersistenceStrategy_initWithJavaIoFile_withComThoughtworksXstreamXStream_(JavaIoFile *baseDirectory, ComThoughtworksXstreamXStream *xstream) {
  ComThoughtworksXstreamPersistenceFilePersistenceStrategy *self = [ComThoughtworksXstreamPersistenceFilePersistenceStrategy alloc];
  ComThoughtworksXstreamPersistenceFilePersistenceStrategy_initWithJavaIoFile_withComThoughtworksXstreamXStream_(self, baseDirectory, xstream);
  return self;
}


#line 71
void ComThoughtworksXstreamPersistenceFilePersistenceStrategy_initWithJavaIoFile_withComThoughtworksXstreamXStream_withNSString_withNSString_(ComThoughtworksXstreamPersistenceFilePersistenceStrategy *self, JavaIoFile *baseDirectory, ComThoughtworksXstreamXStream *xstream, NSString *encoding, NSString *illegalChars) {
  (void) ComThoughtworksXstreamPersistenceAbstractFilePersistenceStrategy_initWithJavaIoFile_withComThoughtworksXstreamXStream_withNSString_(self,
#line 74
  baseDirectory, xstream, encoding);
  self->illegalChars_ = illegalChars;
}


#line 71
ComThoughtworksXstreamPersistenceFilePersistenceStrategy *new_ComThoughtworksXstreamPersistenceFilePersistenceStrategy_initWithJavaIoFile_withComThoughtworksXstreamXStream_withNSString_withNSString_(JavaIoFile *baseDirectory, ComThoughtworksXstreamXStream *xstream, NSString *encoding, NSString *illegalChars) {
  ComThoughtworksXstreamPersistenceFilePersistenceStrategy *self = [ComThoughtworksXstreamPersistenceFilePersistenceStrategy alloc];
  ComThoughtworksXstreamPersistenceFilePersistenceStrategy_initWithJavaIoFile_withComThoughtworksXstreamXStream_withNSString_withNSString_(self, baseDirectory, xstream, encoding, illegalChars);
  return self;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ComThoughtworksXstreamPersistenceFilePersistenceStrategy)
